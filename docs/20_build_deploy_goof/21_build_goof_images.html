<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.113.0">
    <meta name="description" content="">
<meta name="author" content="eric.smalling@snyk.io">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Step 1: Build the Goof container image - Application Modernization with Snyk and GCP</title>

    
    <link href="/css/nucleus.css?1694887915" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1694887915" rel="stylesheet">
    <link href="/css/hybrid.css?1694887915" rel="stylesheet">
    <link href="/css/featherlight.min.css?1694887915" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1694887915" rel="stylesheet">
    <link href="/css/auto-complete.css?1694887915" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1694887915" rel="stylesheet">
    <link href="/css/theme.css?1694887915" rel="stylesheet">
    <link href="/css/tabs.css?1694887915" rel="stylesheet">
    <link href="/css/hugo-theme.css?1694887915" rel="stylesheet">
    
    <link href="/css/foo.css?1694887915" rel="stylesheet"><link href="/css/bar.css?1694887915" rel="stylesheet">

    <script src="/js/jquery-3.3.1.min.js?1694887915"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/20_build_deploy_goof/21_build_goof_images.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><img src="https://res.cloudinary.com/snyk/image/upload/v1537345894/press-kit/brand/logo-black.png"/></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1694887915"></script>
<script type="text/javascript" src="/js/auto-complete.js?1694887915"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1694887915"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/0_introduction.html" title="Container Modernization with Snyk" class="dd-item
        
        
        
        ">
      <a href="/0_introduction.html">
          Container Modernization with Snyk
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/10_prerequisites.html" title="Prerequisites" class="dd-item
        
        
        
        ">
      <a href="/10_prerequisites.html">
          Prerequisites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/10_prerequisites/11_create_gcp_project.html" title="Set up initial GCP and tools" class="dd-item ">
        <a href="/10_prerequisites/11_create_gcp_project.html">
        Set up initial GCP and tools
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/10_prerequisites/12_deploy_gke_cluster.html" title="Deploy a GKE cluster" class="dd-item ">
        <a href="/10_prerequisites/12_deploy_gke_cluster.html">
        Deploy a GKE cluster
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/10_prerequisites/16_clone_goof_repo.html" title="Clone the sample application repo" class="dd-item ">
        <a href="/10_prerequisites/16_clone_goof_repo.html">
        Clone the sample application repo
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/10_prerequisites/17_snyksetup.html" title="Snyk CLI" class="dd-item ">
        <a href="/10_prerequisites/17_snyksetup.html">
        Snyk CLI
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/20_build_deploy_goof.html" title="Module 1: Build the Goof applications" class="dd-item
        parent
        
        
        ">
      <a href="/20_build_deploy_goof.html">
          Module 1: Build the Goof applications
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/20_build_deploy_goof/21_build_goof_images.html" title="Step 1: Build the Goof container image" class="dd-item active">
        <a href="/20_build_deploy_goof/21_build_goof_images.html">
        Step 1: Build the Goof container image
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/20_build_deploy_goof/22_gke_deploy.html" title="Step 2: Deploy the application to GKE" class="dd-item ">
        <a href="/20_build_deploy_goof/22_gke_deploy.html">
        Step 2: Deploy the application to GKE
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/30_secure_container.html" title="Module 2: Secure the Containers" class="dd-item
        
        
        
        ">
      <a href="/30_secure_container.html">
          Module 2: Secure the Containers
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/30_secure_container/31_container_exploit.html" title="Step 3: Exploit a Container Vulnerability" class="dd-item ">
        <a href="/30_secure_container/31_container_exploit.html">
        Step 3: Exploit a Container Vulnerability
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/30_secure_container/32_image_recommendations.html" title="Step 4: Scan the Container Image for Vulnerabilities" class="dd-item ">
        <a href="/30_secure_container/32_image_recommendations.html">
        Step 4: Scan the Container Image for Vulnerabilities
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/30_secure_container/34_redeploy_test.html" title="Step 5: Re-deploy the Application to test the fix" class="dd-item ">
        <a href="/30_secure_container/34_redeploy_test.html">
        Step 5: Re-deploy the Application to test the fix
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/40_secure_application.html" title="Module 3: Secure the application" class="dd-item
        
        
        
        ">
      <a href="/40_secure_application.html">
          Module 3: Secure the application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/40_secure_application/41_integrate_github.html" title="Step 6: Monitor your Repo with Snyk" class="dd-item ">
        <a href="/40_secure_application/41_integrate_github.html">
        Step 6: Monitor your Repo with Snyk
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/40_secure_application/42_opensource_exploit.html" title="Step 7: Exploit a Vulnerable Open Source component" class="dd-item ">
        <a href="/40_secure_application/42_opensource_exploit.html">
        Step 7: Exploit a Vulnerable Open Source component
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/40_secure_application/43_fix_vulnerabilities.html" title="Step 8: Fix a vulnerability with a Snyk Pull Request" class="dd-item ">
        <a href="/40_secure_application/43_fix_vulnerabilities.html">
        Step 8: Fix a vulnerability with a Snyk Pull Request
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/40_secure_application/44_redeploy_verify_fix.html" title="Step 9: Verify the Vulnerability is no longer exploitable." class="dd-item ">
        <a href="/40_secure_application/44_redeploy_verify_fix.html">
        Step 9: Verify the Vulnerability is no longer exploitable.
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/90_conclusion.html" title="Conclusion" class="dd-item
        
        
        
        ">
      <a href="/90_conclusion.html">
          Conclusion
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/90_conclusion/91_recap.html" title="Recap" class="dd-item ">
        <a href="/90_conclusion/91_recap.html">
        Recap
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/90_conclusion/92_cleanup.html" title="Cleanup" class="dd-item ">
        <a href="/90_conclusion/92_cleanup.html">
        Cleanup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Step 1: Build the Goof container image
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#create-the-repository">Create the repository</a></li>
    <li><a href="#log-into-your-repositories">Log into your repositories</a></li>
    <li><a href="#set-a-variable-up-to-hold-the-long-google-repository-string">Set a variable up to hold the long Google repository string</a></li>
    <li><a href="#build-container-images">Build container images</a></li>
    <li><a href="#push-container-images-to-your-google-artifcat-registry">Push container images to your Google Artifcat Registry</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Step 1: Build the Goof container image
            </h1>
          

        


<p>Now that you&rsquo;ve cloned the repo to your working environment, we&rsquo;ll build a few container images that run our application examples in Google Kubernetes Engine (GKE) but before we can do anything, we need to create an Google Artifact Registry (GAR) repository to house the build images so GKE has somewhere to pull them from.</p>
<h2 id="create-the-repository">Create the repository</h2>
<p>The following command will create a repository for the images we will be building:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gcloud artifacts repositories create snyk-workshop --repository-format<span style="color:#f92672">=</span>Docker
</span></span></code></pre></div><p>After it finishes you should get a reponse with the following:</p>
<pre tabindex="0"><code>Created repository [snyk-workshop].
</code></pre><h2 id="log-into-your-repositories">Log into your repositories</h2>
<p>Next, we log into our repositories (one command logs you into any of your repositories)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gcloud auth configure-docker $GCP_REGION-docker.pkg.dev
</span></span></code></pre></div><p>This should return a <code>Login Succeeded</code> repsonse.</p>
<h2 id="set-a-variable-up-to-hold-the-long-google-repository-string">Set a variable up to hold the long Google repository string</h2>
<p>Google Artifact Registry repositories have fairly long names so to make like easier for the rest of this workshop, let&rsquo;s create am environment variable to hold it.  In the following, replace &ldquo;PROJECT-NAME&rdquo; and &ldquo;REGION&rdquo; with whatver your info:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>export REPO<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$GCP_REGION<span style="color:#e6db74">-docker.pkg.dev/</span>$GCP_PROJECT<span style="color:#e6db74">/snyk-workshop&#34;</span>
</span></span></code></pre></div><h2 id="build-container-images">Build container images</h2>
<p>Now we will build the images. Be sure you are cd&rsquo;ed into the top level of the cloned goof repo directory and  run the following commands to build the container images.</p>

<div class="notices info" ><p>The following commands include <code>--platform=linux/amd64</code> to ensure the correct CPU architecture is used for your GKE cluster. This is nessesary if your local workstation is not Intel/AMD based, i.e. Apple Silicon or Raspberry Pi.  If you are on an Intel/AMD based workstation, you may omit that portion if you like.</p>
</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker build -t $REPO/thumbnailer:latest --platform<span style="color:#f92672">=</span>linux/amd64 thumbnailer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker build -t $REPO/todolist:latest --platform<span style="color:#f92672">=</span>linux/amd64  todolist
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker build -t $REPO/log4shell-server:latest --platform<span style="color:#f92672">=</span>linux/amd64 todolist/exploits/log4shell-server
</span></span></code></pre></div><p>When all of the build processes are complete, if you run <code>docker images</code> you should see three rows like this:</p>
<pre tabindex="0"><code>$ docker images                                                                                                                                                             
REPOSITORY         TAG       IMAGE ID       CREATED          SIZE
us-south1-docker.pkg.dev/my-project/snyk-workshop/log4shell-server   latest    a42b0d443129   10 minutes ago   535MB
us-south1-docker.pkg.dev/my-project/snyk-workshop/todolist           latest    57ad8c044dbd   15 minutes ago   612MB
us-south1-docker.pkg.dev/my-project/snyk-workshop/thumbnailer        latest    3406c6d949b4   20 minutes ago   941MB
</code></pre><h2 id="push-container-images-to-your-google-artifcat-registry">Push container images to your Google Artifcat Registry</h2>
<p>Next, we will push the images to our registry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker push $REPO/thumbnailer:latest
</span></span><span style="display:flex;"><span>docker push $REPO/todolist:latest
</span></span><span style="display:flex;"><span>docker push $REPO/log4shell-server:latest
</span></span></code></pre></div><p>Once the pushes complete, log in to your <a href="https://console.cloud.google.com/artifacts">Google Artifact Registry</a> to see your new image repositories (you&rsquo;ll need to open the correct project and click on the <code>snyk-workshop</code> repositry to see the images).</p>
<p><img src="/images/gar-repos.png" alt="gar-repos"></p>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1694887915"></script>
    <script src="/js/perfect-scrollbar.min.js?1694887915"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1694887915"></script>
    <script src="/js/jquery.sticky.js?1694887915"></script>
    <script src="/js/featherlight.min.js?1694887915"></script>
    <script src="/js/highlight.pack.js?1694887915"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1694887915"></script>
    <script src="/js/learn.js?1694887915"></script>
    <script src="/js/hugo-learn.js?1694887915"></script>
    
        
            <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

